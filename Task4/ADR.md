### **Название задачи:** Передача ставок в кол-центр 
### **Автор:** Миннахметов Айрат
### **Дата:** 07.09.2025

### **Функциональные требования**

| **№** | **Действующие лица или системы**         | **Use Case**                | **Описание**                                                                                                          |
|:-----:|:-----------------------------------------|:----------------------------|:----------------------------------------------------------------------------------------------------------------------|
|  F1   | Сотрудник кол-центра, Система кол-центра | Просмотр актуальных ставок  | Сотрудник кол-центра может просматривать актуальные ставки по депозитам в своей системе для консультирования клиентов |
|  F2   | Сотрудник партнёрского кол-центра        | Получение файла со ставками | Сотрудник партнёрского кол-центра получает актуальные ставки в виде файла для консультирования клиентов               |
|  F3   | Сервис ставок, SFTP-сервер               | Выгрузка файла со ставками  | Сервис ставок автоматически выгружает файл с актуальными ставками на SFTP-сервер для партнёрского кол-центра          |
|  F4   | Сотрудник бэк-офиса, АБС                 | Обновление ставок           | Сотрудник бэк-офиса может обновлять ставки по депозитам в АБС, которые затем передаются в кол-центры                  |
|  F5   | Сервис ставок, Система кол-центра        | Синхронизация ставок        | Сервис ставок автоматически синхронизирует актуальные ставки с системой кол-центра банка через API                    |

### **Нефункциональные требования**

| **№** | **Требование**                                                                         |
|:-----:|:---------------------------------------------------------------------------------------|
|  U1   | Интерфейс просмотра ставок должен быть удобным для сотрудников кол-центра              |
|  U2   | Ставки должны отображаться в реальном времени без задержек                             |
|  U3   | Интерфейс должен соответствовать системе дизайна принятой в компании                   |
|  R1   | Система передачи ставок должна работать 24/7 и быть доступна в 99,9% случаев           |
|  R2   | Передача файлов в партнёрский кол-центр должна происходить автоматически по расписанию |
|  P1   | Не должна быть увеличена нагрузка на БД АБС при передаче ставок                        |
|  P2   | Система должна выдерживать нагрузку при увеличении количества запросов на ставки       |
|  S1   | Поддержка системы должна проводиться командой разработки банка                         |
|  S2   | Изменения в системе должны документироваться                                           |
|  +R1  | Передаваемые данные о ставках должны быть зашифрованы                                  |
|  +R2  | Файлы для партнёрского кол-центра должны передаваться через защищенный SFTP-протокол   |
|  +R3  | При доработках нужно использовать технологии, которые уже есть в банке                 |
|  +R4  | Система должна обеспечивать изоляцию данных между банком и партнёрским кол-центром     |

### **Решение**

#### Диаграмма контекста C4

![Контекстная диаграмма](context.puml)

#### Диаграмма контейнеров C4

![Диаграмма контейнеров](container.puml)

#### Описание архитектурного решения

**Основные компоненты:**
- **Система кол-центра банка** (React.js, Java Spring Boot, PostgreSQL) - отображение актуальных ставок для консультирования
- **Партнёрский кол-центр** (внешняя система) - получение файлов со ставками для консультирования клиентов
- **Сервис ставок** (Java Spring Boot) - управление ставками, кэширование и выгрузка файлов
- **АБС** (Delphi, Oracle) - источник актуальных ставок по депозитам
- **SFTP-сервер** - хранение файлов со ставками для партнёрского кол-центра
- **Redis** - кэширование ставок для быстрого доступа

**Промежуточный слой включает:**
- **Сервис ставок** (Java Spring Boot) - получение ставок из АБС, кэширование в Redis, выгрузка файлов на SFTP
- **Redis** - кэширование справочных данных и ставок
- **SFTP-сервер** - хранение файлов со ставками

**Ключевые принципы:**
- Избегание прямой интеграции кол-центра с АБС для снижения нагрузки
- Использование существующих технологий (Java Spring Boot, PostgreSQL, Oracle)
- Кэширование ставок в Redis для быстрого доступа
- Защищенная передача данных через SFTP
- Автоматическая синхронизация ставок по расписанию

**Процесс передачи ставок:**
1. Сотрудник бэк-офиса обновляет ставки в АБС
2. Сервис ставок получает обновленные ставки из АБС
3. Ставки кэшируются в Redis для быстрого доступа
4. Система кол-центра банка получает ставки через API сервиса ставок
5. Сервис ставок формирует и выгружает файл со ставками на SFTP-сервер
6. Партнёрский кол-центр читает файл со ставками с SFTP-сервера

### **Альтернативы**

| **№** | **Альтернатива**                         | **Преимущества**                                    | **Недостатки**                                                   | **Причина отказа**                                             |
|:-----:|:-----------------------------------------|:----------------------------------------------------|:-----------------------------------------------------------------|:---------------------------------------------------------------|
|   1   | Прямая интеграция кол-центра с АБС       | Упрощение архитектуры, снижение времени разработки  | Высокая нагрузка на АБС, нарушение изоляции систем               | Не соответствует требованиям производительности и безопасности |
|   2   | Ручная передача файлов со ставками       | Простота реализации, минимальные затраты            | Высокий риск ошибок, неактуальность данных, операционные затраты | Не соответствует требованиям автоматизации                     |
|   3   | API-интеграция с партнёрским кол-центром | Реальное время, автоматическая синхронизация        | Партнёр не поддерживает API, высокие требования к безопасности   | Технические ограничения партнёра                               |
|   4   | Email-передача файлов со ставками        | Простота, использование существующей инфраструктуры | Низкая безопасность, ограничения размера файлов, ненадежность    | Не соответствует требованиям безопасности                      |
|   5   | Единая база данных для всех кол-центров  | Централизованное управление, консистентность        | Нарушение изоляции, высокие требования к безопасности            | Неприемлемо для внешнего партнёра                              |

**Недостатки, ограничения, риски**

**1. Сложность архитектуры:**
- Увеличивает время разработки и требует дополнительных ресурсов для поддержки
- Дополнительные точки отказа в системе передачи данных

**2. Ограничения синхронизации:**
- Партнёрский кол-центр получает данные не в реальном времени, а по расписанию
- Возможны задержки в получении актуальных ставок партнёром

**3. Технологические ограничения:**
- Зависимость от SFTP-протокола для передачи файлов
- Необходимость поддержки формата файлов, понятного партнёру

**4. Операционные риски:**
- Увеличение сложности мониторинга передачи файлов
- Необходимость контроля целостности передаваемых данных
- Риск сбоев в передаче файлов в партнёрский кол-центр

**5. Безопасность:**
- Необходимость обеспечения безопасности при передаче файлов
- Риск утечки данных при передаче во внешнюю систему

### **Список задач**

| **№** | **Задача**                                                              | **Система**                |
|:-----:|:------------------------------------------------------------------------|:---------------------------|
|   1   | Реализовать API для предоставления ставок в сервисе ставок              | Сервис ставок              |
|   2   | Реализовать получение ставок через API в системе кол-центра банка       | Система кол-центра         |
|   3   | Добавить интерфейс просмотра ставок для сотрудников кол-центра          | Система кол-центра         |
|   4   | Настроить SFTP-сервер для хранения файлов со ставками                   | SFTP-сервер                |
|   5   | Настроить автоматическую выгрузку файлов со ставками по расписанию      | Сервис ставок              |
|   6   | Реализовать механизм чтения файлов со ставками в партнёрском кол-центре | Партнёрский кол-центр      |